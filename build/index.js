var e={d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{Z:()=>n});const a=/matrix\(|\)/g,n=class{constructor(e){this.ownerDom=e.ownerDom,this.allowDrag=e.allowDrag,this.allowScale=e.allowScale,this.extendRate=e.extendRate||10,this.extendStep=e.extendStep||800,this.scaleStep=e.scaleStep||.2,this.scaleOrigin=e.scaleOrigin||1,console.log("HanderLayout ...",this.ownerDom),this.initListener(),this.initStyle()}eventDataMap={allMove:!1,ox:0,oy:0,preX:0,preY:0,iSpeedX:0,iSpeedY:0,lastX:0,lastY:0,curRealX:0,curRealY:0};isElement(e){return e&&1===e.nodeType}get elementTransformStyle(){if(this.isElement(this.ownerDom)){const e=this.ownerDom.style.transform.replace(a,"").split(",");return 6===e.length?{tx:parseFloat(e[4]),ty:parseFloat(e[5]),ts:parseFloat(e[0])}:{tx:0,ty:0,ts:1}}return{tx:0,ty:0,ts:1}}initStyle(){this.isElement(this.ownerDom)&&this.applyTransform({realScale:this.scaleOrigin})}initListener(){this.allowDrag&&(this.bindListener(this.ownerDom,"mousedown",this.dragEvent.mousedown.bind(this)),this.bindListener(this.ownerDom,"mouseup",this.dragEvent.mouseup.bind(this)),this.bindListener(this.ownerDom,"mousemove",this.dragEvent.mousemove.bind(this))),this.allowScale&&this.bindListener(this.ownerDom,"wheel",this.scaleEvent.wheel.bind(this))}bindListener(e,t,a){this.isElement(e)&&e.addEventListener(t,a,!1)}dragEvent={mousedown(e){this.eventDataMap.allMove=!0,this.eventDataMap.ox=this.eventDataMap.lastX=e.clientX,this.eventDataMap.oy=this.eventDataMap.lastY=e.clientY},mouseup(){this.eventDataMap.allMove=!1;const[e,t]=this.getDataBySpeed(this.eventDataMap.iSpeedX,this.eventDataMap.iSpeedY),a=this.getAnimationCoefficient(e,t);let n=0;const s=this;!function i(){window.requestAnimationFrame((()=>{if(n<a.length){let l=e[a[n]]+s.eventDataMap.curRealX,r=t[a[n]]+s.eventDataMap.curRealY;0===e.length&&(l=s.eventDataMap.curRealX),0===t.length&&(r=s.eventDataMap.curRealY),n+=1,s.applyTransform({realX:l,realY:r}),i()}else{let a=e.pop()+s.eventDataMap.curRealX,n=t.pop()+s.eventDataMap.curRealY;0===e.length&&(a=s.eventDataMap.curRealX),0===t.length&&(n=s.eventDataMap.curRealY),s.applyTransform({realX:a,realY:n},!0);const{tx:i,ty:l}=s.elementTransformStyle;s.eventDataMap.iSpeedX=0,s.eventDataMap.iSpeedY=0,s.eventDataMap.preY=l,s.eventDataMap.preX=i}}))}()},mousemove(e){if(this.eventDataMap.allMove){const[t,a]=[e.clientX,e.clientY],n=t-this.eventDataMap.ox+this.eventDataMap.preX,s=a-this.eventDataMap.oy+this.eventDataMap.preY;this.eventDataMap.iSpeedX=t-this.eventDataMap.lastX,this.eventDataMap.iSpeedY=a-this.eventDataMap.lastY,this.eventDataMap.lastX=t,this.eventDataMap.lastY=a,this.applyTransform({realX:n,realY:s}),this.eventDataMap.curRealX=n,this.eventDataMap.curRealY=s}}};scaleEvent={wheel(e){if(0===e.deltaY)return;console.log(e);const[t,a]=[e.clientX,e.clientY],{ts:n}=this.elementTransformStyle,s=e.deltaY<0?-this.scaleStep:this.scaleStep,i=n+s<=0?.1:n+s;this.applyTransform({realScale:i});const l=this.ownerDom.offset;console.log("cx, cy",t,a),console.log("x::",l)}};getAnimationCoefficient(e,t){const a=Math.max(e.length,t.length),n=[];let s=0,i=0;for(let e=0;e<a&&s<a;e++)n.push(s),s+=i,i++;let l=0,r=[];for(let e=i;e>=0;e--){if(l+=e,l>a){l=a,r.push(l);break}r.push(l)}return r}getStepValue(e,t,a){if(0===e)return[];const n=e/t,s=new Array(parseInt(e/n)).fill(n),i=[];return s.reduce(((e,t)=>(i.push(a?-e:e),e+t))),i}getDataBySpeed(e,t){const a=this.extendRate,n=this.extendStep;let s=Math.abs(e)*a,i=Math.abs(t)*a;return[this.getStepValue(s,n,e<0),this.getStepValue(i,n,t<0)]}applyTransform({realX:e,realY:t,realScale:a},n){const{tx:s,ty:i,ts:l}=this.elementTransformStyle;void 0===a&&(a=l),void 0===e&&(e=s,t=i),this.ownerDom.style.transform=`matrix(${a}, 0, 0, ${a}, ${e}, ${t})`,n&&(this.eventDataMap.curRealX=e,this.eventDataMap.curRealY=t)}};var s=t.Z;export{s as default};